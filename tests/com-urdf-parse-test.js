// URDF inertialæ•°æ®è§£ææµ‹è¯•
// æ ¹æ®urdf-loaderæºç ï¼Œæ£€æŸ¥æ•°æ®è®¿é—®æ–¹å¼

console.log('=== URDF Inertialæ•°æ®è®¿é—®æµ‹è¯• ===\n');

console.log('é—®é¢˜åˆ†æ:');
console.log('æ ¹æ®urdf-loaderçš„æºç ï¼ˆURDFClasses.jså’ŒURDFLoader.jsï¼‰ï¼Œæˆ‘å‘ç°:');
console.log('');

console.log('1. urdfNodeçš„ç»“æ„:');
console.log('   - urdfNodeæ˜¯ä¸€ä¸ªXML DOM Element');
console.log('   - urdf-loaderä¼šå°†<link>èŠ‚ç‚¹å­˜å‚¨åœ¨object.urdfNode');
console.log('   - å¯ä»¥ä½¿ç”¨æ ‡å‡†DOM APIè®¿é—®å­å…ƒç´ ');
console.log('');

console.log('2. å½“å‰ä»£ç çš„é—®é¢˜:');
console.log('   comVisualizer.js ç¬¬75-117è¡Œçš„inertialè§£æä»£ç ï¼š');
console.log('   ');
console.log('   ```javascript');
console.log('   if (child.urdfNode && child.urdfNode.children) {');
console.log('     for (let i = 0; i < child.urdfNode.children.length; i++) {');
console.log('       const childElem = child.urdfNode.children[i];');
console.log('       if (childElem.tagName === \'inertial\') { ... }');
console.log('     }');
console.log('   }');
console.log('   ```');
console.log('');
console.log('   è¿™ä¸ªä»£ç é€»è¾‘æœ¬èº«æ˜¯æ­£ç¡®çš„ï¼');
console.log('');

console.log('3. å¯èƒ½çš„å®é™…é—®é¢˜:');
console.log('   âŒ URDFæ–‡ä»¶ä¸­å¯èƒ½ç¼ºå°‘<inertial>æ ‡ç­¾');
console.log('   âŒ æˆ–è€…<inertial>æ ‡ç­¾ä¸­ç¼ºå°‘<mass>æ ‡ç­¾');
console.log('   âŒ æˆ–è€…<mass>çš„valueå±æ€§ä¸º0æˆ–æœªè®¾ç½®');
console.log('');

console.log('4. URDFæ–‡ä»¶æ ¼å¼ç¤ºä¾‹:');
console.log('   æ­£ç¡®çš„URDF linkåº”è¯¥åŒ…å«:');
console.log('');
console.log('   ```xml');
console.log('   <link name="base_link">');
console.log('     <inertial>');
console.log('       <origin xyz="0 0 0.5" rpy="0 0 0"/>');
console.log('       <mass value="10.0"/>');
console.log('       <inertia ixx="1.0" ixy="0.0" ixz="0.0"');
console.log('                iyy="1.0" iyz="0.0" izz="1.0"/>');
console.log('     </inertial>');
console.log('     <visual> ... </visual>');
console.log('   </link>');
console.log('   ```');
console.log('');

console.log('5. æ”¹è¿›å»ºè®®:');
console.log('   æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—æ¥è¯Šæ–­é—®é¢˜ï¼š');
console.log('   - è®°å½•éå†äº†å¤šå°‘ä¸ªlink');
console.log('   - è®°å½•æ‰¾åˆ°äº†å¤šå°‘ä¸ªæœ‰massçš„link');
console.log('   - æ‰“å°æ¯ä¸ªlinkçš„åç§°å’Œè´¨é‡');
console.log('   - å¦‚æœmassCountä¸º0ï¼Œä½¿ç”¨å‡ ä½•ä¸­å¿ƒä½œä¸ºfallbackï¼ˆä»£ç å·²å®ç°ï¼‰');
console.log('');

console.log('=== å»ºè®®çš„æ”¹è¿›ä»£ç  ===\n');

console.log('åœ¨calculateCOMæ–¹æ³•ä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—:');
console.log('');
console.log('```javascript');
console.log('calculateCOM(robot) {');
console.log('  if (!robot) {');
console.log('    console.warn(\'ğŸ¯ COMè®¡ç®—: æœºå™¨äººä¸ºç©º\');');
console.log('    return null;');
console.log('  }');
console.log('');
console.log('  let totalMass = 0;');
console.log('  const comPosition = new THREE.Vector3(0, 0, 0);');
console.log('  const worldPosition = new THREE.Vector3();');
console.log('  let linkCount = 0;');
console.log('  let massCount = 0;');
console.log('  const linkDetails = []; // ç”¨äºè°ƒè¯•');
console.log('');
console.log('  robot.traverse((child) => {');
console.log('    linkCount++;');
console.log('    ');
console.log('    // å°è¯•å¤šç§æ–¹å¼è®¿é—®inertialä¿¡æ¯');
console.log('    let inertial = null;');
console.log('    let mass = 0;');
console.log('    ');
console.log('    if (child.urdfNode && child.urdfNode.children) {');
console.log('      for (let i = 0; i < child.urdfNode.children.length; i++) {');
console.log('        const childElem = child.urdfNode.children[i];');
console.log('        if (childElem.tagName === \'inertial\') {');
console.log('          const massElem = childElem.querySelector(\'mass\');');
console.log('          if (massElem) {');
console.log('            mass = parseFloat(massElem.getAttribute(\'value\')) || 0;');
console.log('          }');
console.log('          ');
console.log('          const originElem = childElem.querySelector(\'origin\');');
console.log('          let origin = null;');
console.log('          if (originElem) {');
console.log('            const xyz = originElem.getAttribute(\'xyz\');');
console.log('            if (xyz) {');
console.log('              const coords = xyz.split(/\\s+/).map(v => parseFloat(v));');
console.log('              origin = { xyz: coords };');
console.log('            }');
console.log('          }');
console.log('          ');
console.log('          inertial = { mass, origin };');
console.log('          break;');
console.log('        }');
console.log('      }');
console.log('    }');
console.log('    ');
console.log('    // è®°å½•è°ƒè¯•ä¿¡æ¯');
console.log('    linkDetails.push({');
console.log('      name: child.name || \'unnamed\',');
console.log('      urdfName: child.urdfName || \'unknown\',');
console.log('      hasUrdfNode: !!child.urdfNode,');
console.log('      hasInertial: !!inertial,');
console.log('      mass: mass');
console.log('    });');
console.log('    ');
console.log('    if (mass > 0 && inertial) {');
console.log('      massCount++;');
console.log('      // ... åŸæœ‰çš„é‡å¿ƒè®¡ç®—é€»è¾‘ ...');
console.log('    }');
console.log('  });');
console.log('');
console.log('  // æ‰“å°è°ƒè¯•ä¿¡æ¯');
console.log('  console.log(`ğŸ¯ COMè®¡ç®—ç»Ÿè®¡:`);');
console.log('  console.log(`  - æ€»linkæ•°: ${linkCount}`);');
console.log('  console.log(`  - æœ‰è´¨é‡çš„linkæ•°: ${massCount}`);');
console.log('  console.log(`  - æ€»è´¨é‡: ${totalMass.toFixed(3)}kg`);');
console.log('  if (massCount === 0) {');
console.log('    console.warn(`  âš ï¸ æœªæ‰¾åˆ°è´¨é‡ä¿¡æ¯ï¼Œä½¿ç”¨å‡ ä½•ä¸­å¿ƒ`);');
console.log('  }');
console.log('  console.table(linkDetails);');
console.log('');
console.log('  if (totalMass > 0) {');
console.log('    comPosition.divideScalar(totalMass);');
console.log('    console.log(`  - è®¡ç®—çš„COMä½ç½®: (${comPosition.x.toFixed(3)}, ${comPosition.y.toFixed(3)}, ${comPosition.z.toFixed(3)})`);');
console.log('    return comPosition;');
console.log('  }');
console.log('');
console.log('  return this.calculateGeometricCenter(robot);');
console.log('}');
console.log('```');
console.log('');

console.log('=== æ€»ç»“ ===');
console.log('âœ… é‡å¿ƒè®¡ç®—çš„æ•°å­¦é€»è¾‘æ˜¯æ­£ç¡®çš„');
console.log('âœ… URDFè§£æçš„ä»£ç é€»è¾‘ä¹Ÿæ˜¯æ­£ç¡®çš„');
console.log('âš ï¸ é—®é¢˜å¾ˆå¯èƒ½æ˜¯URDFæ–‡ä»¶æœ¬èº«ç¼ºå°‘inertialä¿¡æ¯');
console.log('');
console.log('ä¸‹ä¸€æ­¥:');
console.log('1. æ£€æŸ¥å®é™…ä½¿ç”¨çš„URDFæ–‡ä»¶æ˜¯å¦åŒ…å«<inertial>æ ‡ç­¾');
console.log('2. æ·»åŠ è¯¦ç»†æ—¥å¿—ä»¥è¯Šæ–­å®é™…æƒ…å†µ');
console.log('3. å¦‚æœURDFç¡®å®ç¼ºå°‘è´¨é‡ä¿¡æ¯ï¼Œå½“å‰ä»£ç ä¼šæ­£ç¡®fallbackåˆ°å‡ ä½•ä¸­å¿ƒ');
console.log('');
console.log('å»ºè®®æ·»åŠ ä¸€ä¸ªæç¤ºæ¶ˆæ¯ï¼Œå‘Šè¯‰ç”¨æˆ·æ˜¯å¦ä½¿ç”¨äº†å‡ ä½•ä¸­å¿ƒapproximationã€‚');
