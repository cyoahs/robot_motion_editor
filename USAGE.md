# 快速使用指南

## 已修复的问题

### 1. URDF 文件加载
✅ 已安装并正确配置 `urdf-loader@0.12.3`
✅ 支持完整的 URDF 解析，包括：
  - 关节（joints）解析
  - 链接（links）和视觉模型（visual）
  - Mesh 文件加载（STL、DAE等）
  - 包路径解析（package://）

### 2. 关键帧管理
✅ 添加关键帧功能
✅ 删除关键帧功能（两种方式）：
  - 点击"删除当前关键帧"按钮
  - 右键点击时间轴上的关键帧标记
✅ 关键帧在时间轴上显示为绿色标记
✅ 鼠标悬停时标记会放大并变色

## 使用步骤

1. **启动服务器**
   ```bash
   npm run dev
   ```
   或
   ```bash
   ./run.sh
   ```

2. **打开浏览器**
   访问 http://localhost:3000

3. **加载机器人模型**
   - 点击"加载 URDF 文件夹"
   - 选择包含 URDF 文件和 mesh 文件的完整文件夹
   - 等待模型加载完成
   - 3D 视图中会显示机器人模型

4. **加载轨迹**
   - 点击"加载 CSV 轨迹"
   - 选择 CSV 文件（或使用 example_trajectory.csv）
   - 时间轴会更新为轨迹长度

5. **编辑关键帧**
   - 拖动时间轴到想要编辑的时刻
   - 在右侧面板调整关节角度
   - 点击"添加关键帧"
   - 绿色标记会出现在时间轴上

6. **删除关键帧**
   - 方法1: 移动到关键帧位置，点击"删除当前关键帧"
   - 方法2: 右键点击时间轴上的绿色标记

7. **导出轨迹**
   - 点击"导出轨迹"
   - 会下载合并后的 CSV 文件（base + residual）

## CSV 格式

```csv
x, y, z, qx, qy, qz, qw, joint1, joint2, joint3, ...
```

- 前3列：base 位置 (x, y, z)
- 4-7列：base 姿态四元数 (qx, qy, qz, qw)
- 后续列：关节角度（弧度）

## 关键帧残差系统

- **Base轨迹**：CSV 加载的原始数据（只读）
- **Residual残差**：编辑的关键帧相对于 base 的偏移
- **插值**：两个关键帧之间线性插值
- **最终输出**：`final = base + residual`

## 快捷操作

- **左键拖动**：旋转视角
- **右键拖动**：平移视角
- **滚轮**：缩放
- **点击关键帧标记**：跳转到该帧
- **右键关键帧标记**：删除关键帧

## 注意事项

1. 必须先加载 URDF，再加载 CSV
2. CSV 中的关节数量应与 URDF 中的可动关节数量匹配
3. 关键帧会自动保存残差值
4. 导出时会自动合并所有关键帧

## 故障排除

**问题：URDF 加载后看不到模型**
- 检查 mesh 文件是否在正确的相对路径
- 查看浏览器控制台是否有加载错误
- 确认 URDF 文件格式正确

**问题：关节控制不响应**
- 确保 URDF 已正确加载
- 检查关节限制范围
- 查看控制台是否有错误信息

**问题：导出的轨迹不正确**
- 确认已正确设置关键帧
- 检查关键帧是否在有效帧范围内
- 验证 base 轨迹数据正确
